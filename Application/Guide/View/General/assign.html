{include Public/header.html}
<body class="wy-body-for-nav" role="document" xmlns="http://www.w3.org/1999/html">
<div id="nav2">
    <a href="#" id="openToc">
        <img src="data:image/jpg;base64,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" title="切换目录" alt="切换目录" />
    </a>
</div>

<div class="wy-grid-for-nav">
    {include Public/nav.html}

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


        <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
            <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
            <a href="../index.html">ppf</a>
        </nav>



        <div class="wy-nav-content">
            <div class="rst-content">
                <div role="navigation" aria-label="breadcrumbs navigation">
                    <ul class="wy-breadcrumbs">
                        <li><a href="/" target="_blank">ppf 中国</a> &raquo; </li>
                        <li><a href="/guide/index/index">文档首页</a> &raquo; </li>
                        <li><a href="/guide/general/index">常规主题</a> &raquo; </li>

                        <li>模版引擎</li>
                        <li class="wy-breadcrumbs-aside">

                        </li>
                        <div style="float:right;">
                            <div style="text-decoration:underline;color:blue;margin-left:5px;cursor:pointer;" id="closeMe">
                                <img title="目录" alt="toc" src="data:image/gif;base64,R0lGODlhFAAUAJEAAAAAADMzM////wAAACH5BAUUAAIALAAAAAAUABQAAAImlI+py+0PU5gRBRDM3DxbWoXis42X13USOLauUIqnlsaH/eY6UwAAOw==" />
                            </div>
                        </div>
                    </ul>
                    <hr/>
                </div>
                <div role="main" class="document">

                    <div class="section" id="codeigniter">
                        <h1>模版引擎<a class="headerlink" href="#codeigniter" title="永久链接至标题">¶</a></h1>
                        <h2>什么叫做模版引擎？</h2>
                        <p>模板引擎（这里特指用于Web开发的模板引擎）是为了使用户界面与业务数据（内容）分离而产生的，它可以生成特定格式的文档，用于网站的模板引擎就会生成一个标准的HTML文档。</p>
                        <h2>ppf中支持哪些模版引擎？</h2>
                        <p>ppf1.3中支持以下模版引擎</p>

                        <pre>
                            <code>
    {\$add} => &lt?php echo $add;?&gt
    {\if $add >0}aaa{\else}bbb{\/if} => &lt?php if($add > 0){aaa}else{bbbb}; ?&gt
    {\foreach name=$aaa item=key value=val}{\$key}{\$val}{\/foreach} => &lt?php foreach($aaa as $key=>$val){\$key $val} ?&gt
    {\php echo 111;die;}{\/php} => &lt?php echo 111;die; ?&gt
    {\include Public/header.html} =>
    &lt?php include "/Library/WebServer/Documents/mywebsite/Application/Index/View/Public/header.html";?&gt
                            </code>
                        </pre>
                        <div class="admonition note">
                            <p class="first admonition-title">提示</p>
                            <p class="last">切记！！，上面的demo需要将所有的<span style="color: red;font-weight: bolder"> \</span>符号去掉（由于模版引擎的原因，他会被解析）</p>
                        </div>
                        <div class="admonition note">
                            <p class="first admonition-title">提示</p>
                            <p class="last">上面也支持<span style="color: red;font-weight: bolder"> 多重数组赋值，遍历</span></p>
                        </div>
                        <pre><code>
        &lt?php
        $arr = array("tom"=>"yes","john"=>array("qq","ww","ee"));
        $this->view->assign('arr',$arr);
        ?&gt

        视图中可以这样取数

        {\$arr['tom']}
                        </code></pre>
                        <pre><code>
        &lt?php
        $arr = array("tom"=>"yes","john"=>array("qq","ww","ee"));
        $this->view->assign('arr',$arr);
        ?&gt

        视图中可以这样遍历

        {\foreach name=$arr item=key value=val}
            {\foreach name=$val['johh'] item=k value=v}
                {\$k}{\$v}
            {\/foreach}
        {\/foreach}
                        </code></pre>
                        <div class="admonition note">
                            <p class="first admonition-title">提示</p>
                            <p class="last">切记！！，上面的demo需要将所有的<span style="color: red;font-weight: bolder"> \</span>符号去掉（由于模版引擎的原因，他会被解析）</p>
                        </div>
                        <h2>ppf 模版引擎原理</h2>
                        <p>通过相对复杂的正则匹配替换来实现最基础的模版引擎功能，具体大家可以查阅书籍<span style="color: red">PHP核心技术与最佳实践</span> </p>
                        <p>里面有一章专门介绍模版引擎的文章，写的极为好</p>
                        <p>这里贴出重要正则匹配的代码，供大家学习</p>
                        <pre><code>
&lt?php
/**
*  编译类  Compile
*  正则匹配式可拓展  可设定多个编译模版
*
*/
class Compile {
    public $config = array(
        'compiledir' => 'Cache/',         //设置编译后存放的目录
        'suffix_cache' => '.htm',         //设置编译文件的后缀
    );
    public $value = array();
    public $compare_pattern = array();
    public $compare_destpattern = array();
    public $compare_include_pattern = "";
    public function __CONSTRUCT() {
        //添加include 模版
        $this->compare_pattern[] = '#\{\include (.*?)\}#';

        //简单的key value赋值
        $this->compare_pattern[] = '#\{\\$(.*?)\}#';
        //if条件语句实现
        $this->compare_pattern[] = '#\{\if (.*?)\}#';
        $this->compare_pattern[] = '#\{\elseif(.*?)\}#';
        $this->compare_pattern[] = '#\{\else(.*?)\}#';
        $this->compare_pattern[] = '#\{\/if\}#';
        //foreach实现
        $this->compare_pattern[] = '#\{\foreach name=\\$(.*?) item=(.*?) value=(.*?)\}#';
        $this->compare_pattern[] = '#\{\\$(.*?)\}#';
        $this->compare_pattern[] = '#\{\/foreach\}#';
        //支持原生php语言实现
        $this->compare_pattern[] = '#\{\php (.*?)\}#';
        $this->compare_pattern[] = '#\{/php\}#';

        $this->compare_pattern[] = '#\{\compile_include (.*?)\}#';


        //以下是上面几个模版编译后的php语言实现

        $this->compare_destpattern[] = "&lt?php include PPF_PATH.'/'.\$this->config['compiledir'].".Dispath::$current_module.".'/'.md5('".Dispath::$current_controller.'_'.Dispath::$current_action.'_'."\\1').'.php'; ?&gt";

        $this->compare_destpattern[] = "&lt?php echo $\\1;?&gt";

        $this->compare_destpattern[] = "&lt?php if(\\1){ ?&g";
        $this->compare_destpattern[] = "&lt?php }else if(\\1){ ?&g";
        $this->compare_destpattern[] = "&lt?php }else{ ?&g";
        $this->compare_destpattern[] = "&lt?php }?&g";
        $this->compare_destpattern[] = "&lt?php foreach(\$\\1 as \$\\2 => \$\\3){?&g";
        $this->compare_destpattern[] = '&lt?php echo $\\1; ?&g';
        $this->compare_destpattern[] = "&lt?php } ?&g";

        $this->compare_destpattern[] = "&lt?php \\1 ";
        $this->compare_destpattern[] = "?&g";

        $this->compare_destpattern[] = '&lt?php include "'.APPLICATION_PATH.'/'.Dispath::$current_module.'/View/'.'\\1";?&g';

        $this->compare_include_pattern = '#\{\include (.*?)\}#';
    }
    /**
    *   基本的编译功能实现 讲视图文件通过正则匹配编译并写入到php文件中
    *
    */
    public function compile($pre_compile_file,$dest_compile_file) {
        $compile_content = preg_replace($this->compare_pattern,$this->compare_destpattern,file_get_contents($pre_compile_file));
        file_put_contents($dest_compile_file,$compile_content);
    }
    /**
    * @desc 这块内容是先将include编译，然后生成在对应cache目录下的php文件，
    * 将数组回传给Template.php然后在Template.php进行编译
    *
    */
    public function match_include_file($file) {
        $matchArr = array();
        $match_file = preg_match_all($this->compare_include_pattern,file_get_contents($file),$matchArr);
        if($match_file && !empty($matchArr[1])) {
            $include_file_arr = array();
            foreach($matchArr[1] as $key => $val) {
                $compile_file_path = $this->get_compile_file_path();
                $destpatternFile = APPLICATION_PATH."/".Dispath::$current_module."/View/".$val;
                $compile_content = preg_replace($this->compare_pattern,$this->compare_destpattern,file_get_contents($destpatternFile));
                $compile_file = $compile_file_path . md5(Dispath::$current_controller . '_' . Dispath::$current_action.'_'.$val) . '.php';
                file_put_contents($compile_file,$compile_content);
                $include_file_arr[] = $compile_file;
            }
            return $include_file_arr;
        }else {
            return false;
        }
    }
    private function get_compile_file_path() {
        $compile_file_path = PPF_PATH . '/' . $this->config['compiledir'] . Dispath::$current_module . '/';
        return $compile_file_path;
    }
}
?&gt

                        </code></pre>
                        <div class="admonition note">
                            <p class="first admonition-title">提示</p>
                            <p class="last">切记！！，上面的demo需要将所有的<span style="color: red;font-weight: bolder"> \</span>符号去掉（由于模版引擎的原因，他会被解析）</p>
                        </div>
                        <p>在Sys/Template.php文件中也有重要代码</p>
                        <pre><code>
    &lt?php
    if ($this->cache_strategy($php_file, $model_file_arr, $html_file, $compile_file)) {
        $this->compile->value = $this->value;

        /**
        * @desc 这里是先编译include部分的内容，然后在全部编译完毕
        */
        ob_start();
        $this->compile->match_include_file($html_file);
        $this->compile->compile($html_file, $compile_file);
        include "$compile_file";
        /**
        *   这块是得到输出缓冲区的内容并将其写入缓存文件$cache_file中，同时将编译文件跟缓存文件进行赋予755权限
        *   这时可以去看看Cache下面会有2个文件 一个是php文件 一个是htm文件 htm文件就是翻译成html语言的缓存文件
        */
        $message = ob_get_contents();
        /**
        if(file_exists($compile_file)) {
            chmod($compile_file, 0777);
        }
        if(file_exists($cache_file)) {
            chmod($cache_file, 0777);
        }
    */
        $file_line = file_put_contents($cache_file, $message);
        ob_end_flush();
    }
    ?&gt
                        </code></pre>
                        <p>少量的代码构成了如此酷炫的效果，大家是不是很跃跃欲试来学习<a href="https://github.com/taweisuode/ppf">ppf</a> 吧，赶快下载体验吧</p>
                    </div>
                </div>
                {include Public/footer.html}
            </div>
        </div>

    </section>

</div>
{include Public/common_js.html}
</body>
<script>
    hljs.initHighlightingOnLoad();
</script>
</html>